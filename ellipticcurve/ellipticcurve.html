<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECC Encryption/Decryption</title>
    <script>
        async function generateECCKeys() {
            const keyPair = await crypto.subtle.generateKey(
                {
                    name: "ECDH",
                    namedCurve: "P-256"
                },
                true,
                ["deriveKey", "deriveBits"]
            );

            const privateKey = await crypto.subtle.exportKey("pkcs8", keyPair.privateKey);
            const publicKey = await crypto.subtle.exportKey("spki", keyPair.publicKey);

            return {
                privateKey: privateKey,
                publicKey: publicKey
            };
        }

        async function encryptMessage(publicKey, message) {
            const encoder = new TextEncoder();
            const encodedMessage = encoder.encode(message);

            const encrypted = await crypto.subtle.encrypt(
                {
                    name: "RSA-OAEP"
                },
                publicKey,
                encodedMessage
            );

            return encrypted;
        }

        async function decryptMessage(privateKey, encryptedMessage) {
            const decrypted = await crypto.subtle.decrypt(
                {
                    name: "RSA-OAEP"
                },
                privateKey,
                encryptedMessage
            );

            const decoder = new TextDecoder();
            return decoder.decode(decrypted);
        }

        function validateInput(message) {
            if (!message) {
                alert('Please enter a message to encrypt.');
                return false;
            }
            return true;
        }

        async function encryptMessageWithValidation() {
            const message = document.getElementById('message').value;
            if (!validateInput(message)) return;
            try {
                const keys = await generateECCKeys();
                const encrypted = await encryptMessage(keys.publicKey, message);
                document.getElementById('encryptedMessage').textContent = btoa(String.fromCharCode.apply(null, new Uint8Array(encrypted)));
                document.getElementById('publicKey').textContent = btoa(String.fromCharCode.apply(null, new Uint8Array(keys.publicKey)));
                document.getElementById('privateKey').textContent = btoa(String.fromCharCode.apply(null, new Uint8Array(keys.privateKey)));
            } catch (error) {
                console.error('Encryption failed:', error);
                alert('Encryption failed. Please try again.');
            }
        }

        async function decryptMessageWithValidation() {
            const encryptedMessage = document.getElementById('encryptedMessage').textContent;
            const privateKey = document.getElementById('privateKey').textContent;
            try {
                const decrypted = await decryptMessage(
                    await crypto.subtle.importKey(
                        "pkcs8",
                        Uint8Array.from(atob(privateKey), c => c.charCodeAt(0)),
                        { name: "RSA-OAEP", hash: "SHA-256" },
                        true,
                        ["decrypt"]
                    ),
                    Uint8Array.from(atob(encryptedMessage), c => c.charCodeAt(0))
                );
                document.getElementById('decryptedMessage').textContent = decrypted;
            } catch (error) {
                console.error('Decryption failed:', error);
                alert('Decryption failed. Please try again.');
            }
        }

        function setupUI() {
            const messageInput = document.createElement('input');
            messageInput.type = 'text';
            messageInput.id = 'message';
            messageInput.placeholder = 'Enter message to encrypt';

            const encryptButton = document.createElement('button');
            encryptButton.textContent = 'Encrypt';
            encryptButton.onclick = encryptMessageWithValidation;

            const decryptButton = document.createElement('button');
            decryptButton.textContent = 'Decrypt';
            decryptButton.onclick = decryptMessageWithValidation;

            const encryptedMessageDisplay = document.createElement('p');
            encryptedMessageDisplay.id = 'encryptedMessage';

            const decryptedMessageDisplay = document.createElement('p');
            decryptedMessageDisplay.id = 'decryptedMessage';

            const publicKeyDisplay = document.createElement('p');
            publicKeyDisplay.id = 'publicKey';

            const privateKeyDisplay = document.createElement('p');
            privateKeyDisplay.id = 'privateKey';

            document.body.appendChild(messageInput);
            document.body.appendChild(encryptButton);
            document.body.appendChild(decryptButton);
            document.body.appendChild(document.createElement('hr'));
            document.body.appendChild(document.createTextNode('Encrypted Message: '));
            document.body.appendChild(encryptedMessageDisplay);
            document.body.appendChild(document.createTextNode('Decrypted Message: '));
            document.body.appendChild(decryptedMessageDisplay);
            document.body.appendChild(document.createTextNode('Public Key: '));
            document.body.appendChild(publicKeyDisplay);
            document.body.appendChild(document.createTextNode('Private Key: '));
            document.body.appendChild(privateKeyDisplay);
        }

        window.onload = setupUI;
    </script>
</head>
<body>
    <h1>ECC Encryption/Decryption Demo</h1>
</body>
</html>
