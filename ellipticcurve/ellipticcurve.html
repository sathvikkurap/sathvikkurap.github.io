<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECDH Key Exchange</title>
    <script>
        async function generateAndPrintSharedSecret() {
            try {
                // Generate key pairs for two parties
                const aliceKeyPair = await crypto.subtle.generateKey({
                    name: "ECDH",
                    namedCurve: "P-256"
                }, true, ["deriveKey"]);

                const bobKeyPair = await crypto.subtle.generateKey({
                    name: "ECDH",
                    namedCurve: "P-256"
                }, true, ["deriveKey"]);

                // Export Bob's public key
                const bobPublicKey = await crypto.subtle.exportKey("raw", bobKeyPair.publicKey);

                // Derive shared secret using Alice's private key and Bob's public key
                const sharedSecret = await crypto.subtle.deriveKey({
                    name: "ECDH",
                    namedCurve: "P-256",
                    public: await crypto.subtle.importKey(
                        "raw",
                        bobPublicKey,
                        { name: "ECDH", namedCurve: "P-256" },
                        true,
                        []
                    )
                }, aliceKeyPair.privateKey, { name: "AES-GCM", length: 256 }, true, ["encrypt", "decrypt"]);

                // Export the shared secret as raw bytes
                const rawSharedSecret = await crypto.subtle.exportKey("raw", sharedSecret);

                // Convert the raw bytes to a hex string
                const sharedSecretHex = Array.from(new Uint8Array(rawSharedSecret))
                    .map(b => b.toString(16).padStart(2, '0'))
                    .join('');

                // Display the shared secret
                document.getElementById('sharedSecret').textContent = sharedSecretHex;
                console.log('Shared secret generated and displayed');
            } catch (error) {
                console.error('Error generating shared secret:', error);
                document.getElementById('sharedSecret').textContent = 'Error generating shared secret';
            }
        }
    </script>
</head>
<body>
    <h1>Elliptic Curve Diffie-Hellman Key Exchange</h1>
    <button onclick="generateAndPrintSharedSecret()">Generate and Print Shared Secret</button>
    <p>Shared Secret (hex): <span id="sharedSecret"></span></p>
</body>
</html>
